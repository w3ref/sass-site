<!DOCTYPE html> <html class=no-js lang=ru> <head> <meta charset=utf-8> <meta content='IE=edge' http-equiv=X-UA-Compatible> <title>Sass: Cleaning Up Interpolation</title> <meta content='Syntactically Awesome Style Sheets' name=description> <meta content='width=device-width, initial-scale=1' name=viewport> <link href='/feed.xml' rel=alternate type='application/atom+xml'> <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,600|Source+Serif+Pro" rel=stylesheet /> <link href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" rel=stylesheet /> <link href="/assets/css/sass-dfc221cc.css" rel=stylesheet /> <noscript><link href="/assets/css/noscript-c6723936.css" rel=stylesheet /></noscript> <script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PCCZT7S');
</script> </head> <body class='blog blog_cleaning-up-interpolation'> <noscript> <iframe height=0 src='https://www.googletagmanager.com/ns.html?id=GTM-PCCZT7S' style='display:none;visibility:hidden' width=0></iframe> </noscript> <!--[if lt IE 9]><p class=browserupgrade> You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security. </p><![endif]--> <header class=sl-r-banner itemscope=itemscope itemtype='http://schema.org/WPHeader' role=banner> <div class=sl-c-pop-stripe></div> <div class=sl-l-container> <div class='sl-l-grid sl-l-grid--full sl-l-large-grid--fit sl-l-large-grid--center sl-l-large-grid--gutters'> <p class='sl-l-grid__column sl-r-banner__brand'> <a href="/"><img alt=Sass height=48 src="/assets/img/logos/logo-b6e1ef6e.svg"/> </a></p> <nav aria-label='Site navigation' class='sl-r-banner__navigation sl-l-grid__column sl-l-large-grid sl-l-large-grid__column--auto-size sl-c-list-horizontal-wrapper' itemscope=itemscope itemtype='http://schema.org/SiteNavigationElement' role=navigation> <ul> <li><a href="/install">Установить</a></li> <li><a href="/guide">Изучить Sass</a></li> <li><a href="/blog">Блог</a></li> <li><a href="/documentation">Документация</a></li> <li><a href="/community">Участвовать</a></li> <li><label class=visuallyhidden for=s>Поиск</label><input placeholder='Искать' class=search id=s name=s></li> </ul> </nav> </div> </div> </header> <main class=content id=main-content itemprop=mainContentOfPage role=main> <h1 class=sl-l-container> Cleaning Up&nbsp;Interpolation </h1> <div class='sl-background--white sl-l-container sl-l-section'><p class=sl-c-attribution>Posted 9 December 2015 by Natalie Weizenbaum</p> <p>Interpolation—the ability to add variables and other snippets using&nbsp;<code>#{...}</code>—is one of the handiest all-purpose features of Sass. You can use it just&nbsp;about everywhere you might need to inject a variable, a function call, or some&nbsp;other expression. In most of those places it just plops the value into the&nbsp;surrounding text. It&rsquo;s straightforward, easy to understand, and useful, which is&nbsp;exactly what we want from a&nbsp;feature.</p> <p>Unfortunately, that&rsquo;s only true in <em>most places</em>. For complicated&nbsp;historical reasons, there&rsquo;s one place where interpolation goes a little bit bananas:&nbsp;inside an expression but outside quotes. Most of the time, it makes sense; if you&nbsp;write <code>display: -#{$prefix}-box</code>, you&rsquo;ll get what you expect. But if any&nbsp;operators like <code>+</code> are used next to the interpolation, you start to get weird output.&nbsp;For example, <code>$name + #{$counter + 1}</code> might return an unquoted string&nbsp;containing the text&nbsp;<code>name + 3</code>.</p> <p>This is really weird behavior. Why does <code>+</code> behave differently here than it&nbsp;does everywhere else? Why is it treated as plain text when <code>$name</code> gets&nbsp;evaluated normally? This behavior is confusing, inconsistent, and not particularly&nbsp;useful, which are very much <em>not</em> things we want in a feature. So why do they exist&nbsp;in the first&nbsp;place?</p> <h2 id=complicated-historical-reasons> <a class=anchor href="#complicated-historical-reasons"><span class=visuallyhidden>Complicated Historical Reasons permalink</span></a>Complicated Historical&nbsp;Reasons</h2> <p><em>If you don&rsquo;t care for a history lesson, skip on down to <a href="#a-brave-new-world">A Brave&nbsp;New World</a>.</em></p> <p>Way back in the dawn of time, when the indented syntax was the only syntax,&nbsp;Sass had a distinction between &ldquo;static&rdquo; and &ldquo;dynamic&rdquo; properties. A static&nbsp;property was basically plain <span class=caps>CSS</span>; it was declared using <code>property: value</code>, and the&nbsp;value was used as-is without any further processing. If you wanted to use a&nbsp;variable or a function, you had to use a dynamic property, which was declared&nbsp;using <code>property= value</code>. A You&rsquo;d see a lot of stylesheets like&nbsp;this:</p> <pre class="highlight sass"><code><span class="nc">.border</span>
  <span class="nl">border-width</span><span class="p">:</span> <span class="m">4px</span>
  <span class="nl">border-style</span><span class="p">:</span> <span class="nb">solid</span>
  <span class="nt">border-color</span><span class="o">=</span> <span class="o">!</span><span class="nt">background_color</span>
</code></pre> <p>Also, in the dawn of time, variables used <code>!</code> instead of <code>$</code> and&nbsp;couldn&rsquo;t include hyphens. The dawn of time kind of sucked. But it was in this&nbsp;context that we first added interpolation. We wanted to allow properties like&nbsp;<code>border</code> with multiple values to be partially dynamic, so we decided to follow in&nbsp;Ruby&rsquo;s footsteps and allow <code>#{}</code> to be used to drop in values. Soon stylesheets&nbsp;started looking like&nbsp;this:</p> <pre class="highlight sass"><code><span class="nc">.border</span>
  <span class="nl">border</span><span class="p">:</span> <span class="m">4px</span> <span class="nb">solid</span> <span class="si">#{</span><span class="o">!</span><span class="n">background_color</span><span class="si">}</span>
</code></pre> <p>That&rsquo;s so much better! And for a while, all was&nbsp;calm.</p> <h3 id=then-came-scss> <a class=anchor href="#then-came-scss"><span class=visuallyhidden>Then Came <span class=caps>SCSS</span> permalink</span></a>Then Came&nbsp;<span class=caps>SCSS</span></h3> <p>It eventually became clear that users really strongly wanted their&nbsp;stylesheets to look like <span class=caps>CSS</span>, so we sat down and started work on the syntax that&nbsp;would become <span class=caps>SCSS</span> in the release that would become Sass 3. As part of this work,&nbsp;we decided to get rid of the distinction between static and dynamic&nbsp;properties altogether. Having all properties work the same way was obviously great&nbsp;for users, but it meant we had to figure out how to merge the two syntaxes with&nbsp;a minimum of&nbsp;pain.</p> <p>This was mostly straightforward, since the old expression syntax was pretty&nbsp;much universally invalid <span class=caps>CSS</span> or something that emitted its <span class=caps>CSS</span> value anyway.&nbsp;But interpolation proved tricky. Backwards compatibility is really important to&nbsp;us, so we wanted to be sure that all the places interpolation was used—or <em>could theoretically be used</em>—in Sass 2 would continue to work in Sass 3, even&nbsp;though everything around them was now fully&nbsp;parsed.</p> <p>Our solution was to make basically anything around <code>#{}</code> that wasn&rsquo;t&nbsp;obviously part of a plain-<span class=caps>CSS</span> expression turn into a string. That way, hopefully any&nbsp;weird corner cases that people had would keep working when they upgraded. This led&nbsp;to the weird behavior I described above, but at the time our top priority&nbsp;was making it as easy as possible for users to migrate to Sass 3. We decided&nbsp;the weirdness was worth it, and shipped&nbsp;it.</p> <h2 id=a-brave-new-world> <a class=anchor href="#a-brave-new-world"><span class=visuallyhidden>A Brave New World permalink</span></a>A Brave New&nbsp;World</h2> <p>Flash forward to today. We&rsquo;re now starting work on the next major release,&nbsp;Sass 4, and (I dearly hope) no one&rsquo;s written any Sass 2 stylesheets in years. A&nbsp;major release is a great opportunity to clean up this bit of historical cruft,&nbsp;and after <a href="https://github.com/sass/sass/issues/1778">discussing it extensively on the&nbsp;issue tracker</a> we decided to make&nbsp;the change.</p> <p>There are three major steps in a backwards-incompatible change like this.&nbsp;The first is to design the new syntax, which was pretty easy here, since&nbsp;it&rsquo;s basically just &ldquo;do what everyone thought it did already.&rdquo; We just had to&nbsp;take that general notion and suss out the&nbsp;specifics.</p> <p>We ended up framing it as <code>#{}</code> being, syntactically, part of an&nbsp;identifier. When you write <code>-#{$prefix}-box</code>, Sass parses it as a single&nbsp;identifier containing <code>&quot;-&quot;</code> followed by the value of <code>$prefix</code> followed by <code>&quot;-box&quot;</code>.&nbsp;Even if you write <code>#{$font}</code> all on its own, it&rsquo;s parsed as an identifier that&nbsp;only contains the value of <code>$font</code>. This way, interpolation doesn&rsquo;t have&nbsp;weird behavior around operators any more than identifiers ever&nbsp;did.</p> <p>Once we had a design, the second step was to deprecate the old behavior.&nbsp;The meat of deprecation is figuring out when to print a warning, and that was&nbsp;pretty tough here. We didn&rsquo;t want to warn for situations that would continue to&nbsp;work, even when they involved operators—for example, <code>12px/#{$line-height}</code> will&nbsp;print the right thing in the old and new worlds (although for slightly&nbsp;different reasons), but <code>12px+#{$line-height}</code>&nbsp;won&rsquo;t.</p> <p>I won&rsquo;t go into the gory details of how we got deprecation working here;&nbsp;that&rsquo;s what the <a href="https://github.com/sass/sass/issues/1778">GitHub issue</a> is&nbsp;for. Suffice it to say that it involved a lot of special cases, including some&nbsp;where a deprecation warning can be printed based on how a value is <em>used</em> rather&nbsp;than how it&rsquo;s <em>written</em>. I&rsquo;m pretty happy with where it ended up, though; I&nbsp;suspect it&rsquo;ll catch 99% of cases that will actually break in&nbsp;practice.</p> <p>Another exciting bonus was the ability to automatically update code.&nbsp;This doesn&rsquo;t always work when introducing backwards-incompatibilities, but in&nbsp;this case we were able to make <code>sass-convert</code> convert deprecated uses&nbsp;of interpolation into Sass 4-compatible code. It has some false negatives—it&nbsp;only converts cases it can prove will be incompatible—but it&rsquo;s enough to get users&nbsp;a long way&nbsp;there.</p> <p>The final step once the deprecation was in place was to move to <a href="https://github.com/sass/sass/commits/main">the&nbsp;<code>main</code> branch</a> (which will&nbsp;eventually become Sass 4), rip out all the old behavior, and implement the new. And it&nbsp;was <em>wonderful</em>. Deleting gross code and replacing it with something clean&nbsp;feels like taking a shower after spending a day hiking through dust under a hot&nbsp;sun. And after working on this feature for weeks, I was happy to see the other end&nbsp;of it.</p> <h2 id=checking-it-out> <a class=anchor href="#checking-it-out"><span class=visuallyhidden>Checking it Out permalink</span></a>Checking it&nbsp;Out</h2> <p>Sass <span class=caps>3.4.20</span>, released today, was the first release to include the&nbsp;deprecation warnings for the old syntax. If you want to check whether you&rsquo;ve got&nbsp;any deprecated interpolations lurking in your stylesheets, just&nbsp;<code>gem install sass</code> and recompile your stylesheet. And if you do find some, try&nbsp;running <code>sass-convert --recursive --in-place .</code> to fix a bunch&nbsp;automatically.</p> <p>If you want to try out the new syntax, <span class=caps>4.0.0</span>.alpha.1 was also released&nbsp;today. You can get it with <code>gem install sass --prerelease</code>. But beware: it is&nbsp;alpha software, so it may change in the future. We generally try to keep even&nbsp;our prereleases pretty stable, but there&rsquo;s also a chance you&rsquo;ll run into a&nbsp;bug.</p> <p>If you do find a bug, please file it on <a href="https://github.com/sass/sass/issues">the&nbsp;issue tracker</a>. Even if it&rsquo;s something as&nbsp;simple as a typo, we want to know. If we&rsquo;ve deprecated something that should be&nbsp;valid, we <em>especially</em> want to know. And if you just have a question, feel free&nbsp;to tweet at <a href="https://twitter.com/SassCSS">@Sass<span class=caps>CSS</span></a> or post it on the <a href="https://groups.google.com/forum/#!forum/sass-lang">mailing list</a>.</p> </div> <div class=sl-c-alert> <div aria-labelledby=release-nav class='sl-l-container sl-c-list-horizontal-wrapper'> <ul class=sl-l-grid--justify-center> <li id=release-nav> Текущие релизы: </li> <li> <span class=release-name><a href="/dart-sass">Dart Sass</a>&#32;<a href="https://github.com/sass/dart-sass/releases/tag/1.38.2">1.38.2</a></span> </li> <li> <span class=release-name><a href="/libsass">LibSass</a>&#32;<a href="https://github.com/sass/libsass/releases/tag/3.6.5">3.6.5</a></span> </li> <li> <span class=release-name><a href="/ruby-sass">Ruby Sass</a><span aria-label=coffin role=presentation> &#32; ⚰ </span></span> </li> <li class='sl-l-grid__column sl-l-large-grid__column--auto-size'> <a href="/implementation">Руководство по внедрению</a> </li> </ul> </div> </div> </main> <footer class='site-footer contentinfo' itemscope=itemscope itemtype='http://schema.org/WPFooter' role=contentinfo> <div class='sl-l-container sl-l-section'> <div class='sl-l-grid sl-l-grid--full sl-l-large-grid--fit sl-l-large-grid--center sl-l-large-grid--gutters'> <div class=sl-l-grid__column> <p>Sass &copy; 2006&ndash;2021 команда Sass и многочисленные участники. Он доступен для использования и модификации по <a href="https://github.com/sass/dart-sass/blob/master/LICENSE">лицензии MIT&nbsp;</a>.</p> <nav class=sl-c-list-horizontal-wrapper> <ul> <li><a href="https://github.com/sass">Sass на GitHub</a></li> <li><a href="https://github.com/w3ref/sass-site">Исходный код веб-сайта</a></li> <li><a href="/styleguide">Руководство по стилю</a></li> <li><a href="/community-guidelines">Рекомендации сообщества</a></li> </ul> </nav> </div> <div class='sl-l-grid__column sl-l-large-grid__column--auto-size sl-l-large-grid--justify-right'> <a class=twitter-follow-button data-show-count=false data-size=large href='https://twitter.com/SassCSS'> Следите за @SassCSS </a> <script>
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
</script> </div> </div> </div> </footer> <script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script> <script>
  docsearch({
    apiKey: 'a409ff5d6a2476083c1a8dd1f8c04ec5',
    indexName: 'sass-lang',
    inputSelector: 'input.search',
    transformData: function(hits) {
      var domain = window.location.origin + "/";
      hits.forEach(function(hit) {
        if (!hit.url.startsWith(domain)) {
          hit.url = hit.url.replace(/^https?:\/\/[^\/]+\//, domain);
        }
      });
      return hits;
    },
    debug: false
  });
</script> <script src="/assets/js/sass-b8cb06ab.js"></script> </body> </html>